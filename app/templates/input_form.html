<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input Aset Baru</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA & Icon -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="/static/icon-192.png" sizes="192x192" type="image/png">

    <!-- Style & Tom Select -->
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 1rem;
            max-width: 720px;
            margin: auto;
        }
        h1 {
            text-align: center;
            color: #1976d2;
        }
        form {
            background-color: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        label {
            margin-top: 1rem;
            font-weight: bold;
            display: block;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
        }
        button {
            margin-top: 1.5rem;
            background-color: #1976d2;
            color: white;
            padding: 10px;
            border: none;
            width: 100%;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        button:hover {
            background-color: #125ea2;
        }
        .back-link {
            display: block;
            margin: 1rem 0;
            text-align: center;
            text-decoration: none;
            color: #1976d2;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<h1>➕ Input Aset Baru</h1>
<a href="/" class="back-link">🔙 Kembali ke Beranda</a>

<form method="post" action="/submit">
    <label>📦 Nama Aset</label>
    <input type="text" name="item_name" required>

    <label>📁 Kategori</label>
    <select name="category" id="category" required>
        <option value="">-- Pilih Kategori --</option>
        {% for cat in refs.categories %}
            <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}
    </select>

    <label>🧩 Tipe</label>
    <select name="type" id="type" required>
        {% for t in refs.types %}
            <option value="{{ t.Type }}">{{ t.Type }} ({{ t.Category }})</option>
        {% endfor %}
    </select>

    <label>🏭 Merk / Manufacture</label>
    <input type="text" name="manufacture">

    <label>📎 Model</label>
    <input type="text" name="model">

    <label>🔢 Nomor Seri</label>
    <input type="text" name="serial_number">

    <label>🏢 Perusahaan</label>
    <select name="company" id="company" onchange="toggleCodeCompany()" required>
        <option value="">-- Pilih Perusahaan --</option>
        {% for c in refs.companies %}
            <option value="{{ c }}">{{ c }}</option>
        {% endfor %}
    </select>

    <div id="code_company_group" class="hidden">
        <label>🏷️ Kode Perusahaan</label>
        <input type="text" name="code_company" maxlength="3">
    </div>

    <label>🏭 Unit Bisnis</label>
    <input type="text" name="bisnis_unit">

    <label>📍 Lokasi</label>
    <select name="location" id="location" onchange="updateRooms()" required>
        <option value="">-- Pilih Lokasi --</option>
        {% for loc in refs.locations %}
            <option value="{{ loc }}">{{ loc }}</option>
        {% endfor %}
    </select>

    <label>🏢 Ruangan</label>
    <select name="room_location" id="room_location" required>
        <option value="">-- Pilih Ruangan --</option>
    </select>

    <label>📝 Catatan</label>
    <textarea name="notes" rows="2"></textarea>

    <label>⚙️ Kondisi</label>
    <input type="text" name="condition">

    <label>🗓️ Tanggal Pembelian</label>
    <input type="date" name="purchase_date" required>

    <label>💰 Harga Pembelian</label>
    <input type="number" name="purchase_cost" required>

    <label>📜 Garansi</label>
    <select name="warranty" id="warranty">
        <option value="No">No</option>
        <option value="Yes">Yes</option>
    </select>

    <label>🚚 Supplier</label>
    <input type="text" name="supplier">

    <label>📖 Jurnal</label>
    <input type="text" name="journal">

    <label>👤 Owner Asset</label>
    <select name="owner" id="owner" required>
        <option value="">-- Pilih Penanggung Jawab --</option>
        {% for o in refs.owners %}
            <option value="{{ o }}">{{ o }}</option>
        {% endfor %}
    </select>

    <button type="submit">✅ Simpan Aset</button>
</form>

<!-- Tom Select JS -->
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
<script>
    const roomMap = {{ location_room_map | tojson | safe }};

    function updateRooms() {
        const location = document.getElementById("location").value;
        const roomSelect = document.getElementById("room_location");
        roomSelect.innerHTML = '<option value="">-- Pilih Ruangan --</option>';
        if (roomMap[location]) {
            roomMap[location].forEach(r => {
                const opt = document.createElement("option");
                opt.value = r;
                opt.textContent = r;
                roomSelect.appendChild(opt);
            });
            new TomSelect("#room_location", { create: false });
        }
    }

    function toggleCodeCompany() {
        const input = document.getElementById("company");
        const known = [...document.querySelectorAll("#company option")].map(e => e.value);
        const group = document.getElementById("code_company_group");
        group.classList.toggle("hidden", known.includes(input.value));
    }

    // Init all TomSelect
    new TomSelect("#category", { create: false, maxOptions: 100 });
    new TomSelect("#type", { create: true, maxOptions: 100 });
    new TomSelect("#company", { create: true, maxOptions: 100 });
    new TomSelect("#location", { create: true, maxOptions: 100 });
    new TomSelect("#room_location", { create: true, maxOptions: 100 });
    new TomSelect("#owner", { create: false, maxOptions: 100 });
    new TomSelect("#warranty", { create: false });
</script>
</body>
</html>
