<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input Aset Baru</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="/static/icon-192.png" sizes="192x192" type="image/png">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 1rem; max-width: 720px; margin: auto; }
        h1 { text-align: center; color: #1976d2; }
        form { background-color: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
        label { margin-top: 1rem; font-weight: bold; display: block; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        button { margin-top: 1.5rem; background-color: #1976d2; color: white; padding: 10px; border: none; width: 100%; font-size: 16px; border-radius: 6px; cursor: pointer; }
        button:hover { background-color: #125ea2; }
        .back-link { display: block; margin: 1rem 0; text-align: center; text-decoration: none; color: #1976d2; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>➕ Input Aset Baru</h1>
    <a href="/" class="back-link">🔙 Kembali ke Beranda</a>

    <form method="post" action="/submit">
        <label for="item_name">📦 Nama Aset</label>
        <input type="text" id="item_name" name="item_name" required>

        <label for="category">📁 Kategori</label>
        <select id="category" name="category" required>
            <option value="">-- Pilih Kategori --</option>
            {% for cat in refs.categories %}
                <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
        </select>

        <label for="type">🧩 Tipe</label>
        <input list="type_list" id="type" name="type" required>
        <datalist id="type_list">
            {% for t in refs.types %}
                <option value="{{ t.Type }}">{{ t.Type }} ({{ t.Category }})</option>
            {% endfor %}
        </datalist>

        <label for="manufacture">🏭 Merk / Manufacture</label>
        <input type="text" id="manufacture" name="manufacture">

        <label for="model">📎 Model</label>
        <input type="text" id="model" name="model">

        <label for="serial_number">🔢 Nomor Seri</label>
        <input type="text" id="serial_number" name="serial_number">

        <label for="company">🏢 Perusahaan</label>
        <input list="company_list" id="company" name="company" onchange="toggleCodeCompany()" required>
        <datalist id="company_list">
            {% for c in refs.companies %}
                <option value="{{ c }}">
            {% endfor %}
        </datalist>

        <div id="code_company_group" class="hidden">
            <label for="code_company">🏷️ Kode Perusahaan</label>
            <input type="text" id="code_company" name="code_company" maxlength="3">
        </div>

        <label for="bisnis_unit">🏭 Unit Bisnis</label>
        <input type="text" id="bisnis_unit" name="bisnis_unit">

        <label for="location">📍 Lokasi</label>
        <input list="location_list" id="location" name="location" onchange="updateRooms()" required>
        <datalist id="location_list">
            {% for loc in refs.locations %}
                <option value="{{ loc }}">
            {% endfor %}
        </datalist>

        <label for="room_location">🏢 Ruangan</label>
        <input list="room_list" id="room_location" name="room_location" required>
        <datalist id="room_list">
            <!-- Populated via JS -->
        </datalist>

        <label for="notes">📝 Catatan</label>
        <textarea id="notes" name="notes" rows="2"></textarea>

        <label for="condition">⚙️ Kondisi</label>
        <input type="text" id="condition" name="condition">

        <label for="purchase_date">🗓️ Tanggal Pembelian</label>
        <input type="date" id="purchase_date" name="purchase_date" required>

        <label for="purchase_cost">💰 Harga Pembelian</label>
        <input type="number" id="purchase_cost" name="purchase_cost" required>

        <label for="warranty">📜 Garansi</label>
        <select id="warranty" name="warranty">
            <option value="No">No</option>
            <option value="Yes">Yes</option>
        </select>

        <label for="supplier">🚚 Supplier</label>
        <input type="text" id="supplier" name="supplier">

        <label for="journal">📖 Jurnal</label>
        <input type="text" id="journal" name="journal">

        <label for="owner">👤 Penanggung Jawab</label>
        <select id="owner" name="owner" required>
            <option value="">-- Pilih Penanggung Jawab --</option>
            {% for o in refs.owners %}
                <option value="{{ o }}">{{ o }}</option>
            {% endfor %}
        </select>

        <button type="submit">✅ Simpan Aset</button>
    </form>

    <script>
        const roomMap = {{ location_room_map | tojson | safe }};

        function updateRooms() {
            const loc = document.getElementById("location").value;
            const roomList = document.getElementById("room_list");
            roomList.innerHTML = "";

            if (roomMap[loc]) {
                roomMap[loc].forEach(room => {
                    const opt = document.createElement("option");
                    opt.value = room;
                    roomList.appendChild(opt);
                });
            }
        }

        function toggleCodeCompany() {
            const input = document.getElementById("company").value;
            const knownCompanies = [...document.querySelectorAll("#company_list option")].map(opt => opt.value);
            const group = document.getElementById("code_company_group");

            group.classList.toggle("hidden", knownCompanies.includes(input));
        }
    </script>
	<script>
		const knownTypes = [...document.querySelectorAll("#type_list option")].map(opt => opt.value);
		const knownLocations = [...document.querySelectorAll("#location_list option")].map(opt => opt.value);
		const knownRooms = [...document.querySelectorAll("#room_list option")].map(opt => opt.value);

		const form = document.querySelector("form");

		form.addEventListener("submit", function (e) {
			const type = document.querySelector("[name='type']").value;
			const location = document.querySelector("[name='location']").value;
			const room = document.querySelector("[name='room_location']").value;

			let confirmMessage = "";

			if (!knownTypes.includes(type)) {
				confirmMessage += `🧩 Tipe "${type}" belum terdaftar. Tambah baru?\n`;
			}
			if (!knownLocations.includes(location)) {
				confirmMessage += `📍 Lokasi "${location}" belum terdaftar. Tambah baru?\n`;
			}
			if (!knownRooms.includes(room)) {
				confirmMessage += `🏢 Ruangan "${room}" belum terdaftar. Tambah baru?\n`;
			}

			if (confirmMessage && !confirm(confirmMessage)) {
				e.preventDefault();
			}
		});
	</script>

</body>
</html>
