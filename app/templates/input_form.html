<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Input Aset Baru</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="/static/manifest.json" />
  <meta name="theme-color" content="#1976d2" />
  <link rel="icon" href="/static/icon-192.png" sizes="192x192" type="image/png" />
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 1rem; max-width: 720px; margin: auto; }
    form { background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
    label { margin-top: 1rem; font-weight: bold; display: block; }
    input, select, textarea { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 6px; }
    button { margin-top: 1.5rem; background: #1976d2; color: white; padding: 10px; border: none; width: 100%; font-size: 16px; border-radius: 6px; cursor: pointer; }
    button:hover { background-color: #125ea2; }
    .back-link { display: block; margin: 1rem 0; text-align: center; text-decoration: none; color: #1976d2; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>â• Input Aset Baru</h1>
  <a href="/" class="back-link">ğŸ”™ Kembali ke Beranda</a>

  <form method="post" action="/submit">
    <label>ğŸ“¦ Nama Aset</label>
    <input type="text" name="item_name" required />

    <label>ğŸ“ Kategori</label>
    <select name="category" required>
      <option value="">-- Pilih Kategori --</option>
      {% for cat in refs.categories %}
        <option value="{{ cat }}">{{ cat }}</option>
      {% endfor %}
    </select>

    <label>ğŸ§© Tipe</label>
    <input list="type_list" name="type" id="type" />
    <datalist id="type_list">
      {% for t in refs.types %}
        <option value="{{ t.Type }}">{{ t.Type }} ({{ t.Category }})</option>
      {% endfor %}
    </datalist>

    <label>ğŸ­ Merk / Manufacture</label>
    <input type="text" name="manufacture" />

    <label>ğŸ“ Model</label>
    <input type="text" name="model" />

    <label>ğŸ”¢ Nomor Seri</label>
    <input type="text" name="serial_number" />

    <label>ğŸ¢ Perusahaan</label>
    <input list="company_list" name="company" id="company" required oninput="checkCompanyNew()" />
    <datalist id="company_list">
      {% for c in refs.companies %}
        <option value="{{ c }}">
      {% endfor %}
    </datalist>
    <button type="button" id="add_company_btn" class="hidden" onclick="confirmAddCompany()">â• Tambah Perusahaan Baru</button>

    <div id="new_company_group" class="hidden">
      <label>ğŸ¢ Nama Perusahaan Baru</label>
      <input type="text" name="new_company" id="new_company" />

      <label>ğŸ·ï¸ Kode Perusahaan Baru</label>
      <input type="text" name="new_code_company" id="new_code_company" maxlength="3" />
    </div>

    <div id="code_company_group">
      <label>ğŸ·ï¸ Kode Perusahaan</label>
      <input type="text" name="code_company" id="code_company" maxlength="3" required />
    </div>

    <label>ğŸ­ Unit Bisnis</label>
    <input type="text" name="bisnis_unit" />

    <label>ğŸ“ Lokasi</label>
    <input list="location_list" name="location" id="location" onchange="updateRooms()" required />
    <datalist id="location_list">
      {% for loc in refs.locations %}
        <option value="{{ loc }}">
      {% endfor %}
    </datalist>

    <label>ğŸ¢ Ruangan</label>
    <input list="room_list" name="room_location" id="room_location" required />
    <datalist id="room_list">
      {% for r in refs.rooms %}
        <option value="{{ r }}">
      {% endfor %}
    </datalist>

    <label>ğŸ“ Catatan</label>
    <textarea name="notes" rows="2"></textarea>

    <label>âš™ï¸ Kondisi</label>
    <input type="text" name="condition" />

    <label>ğŸ—“ï¸ Tanggal Pembelian</label>
    <input type="date" name="purchase_date" required />

    <label>ğŸ’° Harga Pembelian</label>
    <input type="number" name="purchase_cost" required />

    <label>ğŸ“œ Garansi</label>
    <select name="warranty">
      <option value="No">No</option>
      <option value="Yes">Yes</option>
    </select>

    <label>ğŸšš Supplier</label>
    <input type="text" name="supplier" />

    <label>ğŸ“– Jurnal</label>
    <input type="text" name="journal" />

    <label>ğŸ‘¤ Penanggung Jawab</label>
    <select name="owner" required>
      <option value="">-- Pilih Penanggung Jawab --</option>
      {% for o in refs.owners %}
        <option value="{{ o }}">{{ o }}</option>
      {% endfor %}
    </select>

    <button type="submit">âœ… Simpan Aset</button>
  </form>

  <script>
    const roomMap = {{ location_room_map | tojson | safe }};

    function updateRooms() {
      const location = document.getElementById("location").value;
      const roomList = document.getElementById("room_list");
      roomList.innerHTML = '';
      if (roomMap[location]) {
        roomMap[location].forEach(room => {
          const opt = document.createElement("option");
          opt.value = room;
          roomList.appendChild(opt);
        });
      }
    }

    function checkCompanyNew() {
      const input = document.getElementById("company").value;
      const known = [...document.querySelectorAll("#company_list option")].map(o => o.value);
      const btn = document.getElementById("add_company_btn");
      const group = document.getElementById("new_company_group");
      const codeGroup = document.getElementById("code_company_group");

      if (!known.includes(input)) {
        btn.classList.remove("hidden");
        codeGroup.classList.add("hidden");
      } else {
        btn.classList.add("hidden");
        group.classList.add("hidden");
        codeGroup.classList.remove("hidden");
        document.getElementById("new_company").value = "";
        document.getElementById("new_code_company").value = "";
      }
    }

    function confirmAddCompany() {
      if (confirm("Perusahaan belum terdaftar. Tambah perusahaan dan kode perusahaan baru?")) {
        document.getElementById("new_company_group").classList.remove("hidden");
        document.getElementById("add_company_btn").classList.add("hidden");
      }
    }
  </script>
</body>
</html>
