<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Input Aset</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- PWA -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1976d2">
    <link rel="icon" href="/static/icon-192.png" sizes="192x192" type="image/png">

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            max-width: 720px;
            margin: 0 auto;
            padding: 1rem;
        }

        h1 {
            text-align: center;
            color: #1976d2;
        }

        form {
            display: grid;
            gap: 12px;
        }

        label {
            font-weight: bold;
        }

        input, select, textarea {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #145ea8;
        }
    </style>
</head>
<body>
    <h1>üì¶ Input Aset</h1>
	<p style="text-align: center;">
		<a href="/" style="padding: 8px 16px; background-color: #eee; color: #1976d2; border-radius: 5px; text-decoration: none;">
			üîô Back to Home
		</a>
	</p>
    <form method="post" action="/input">
        <label>Item Name</label>
        <input type="text" name="item_name" required>

        <label>Category</label>
        <select name="category" id="category" required onchange="filterTypes()">
            <option value="">-- Pilih Category --</option>
            {% for c in categories %}
                <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
        </select>

        <label>Type</label>
        <select name="type_" id="type_" required>
            <option value="">-- Pilih Type --</option>
            {% for t in types %}
                <option value="{{ t.type }}" data-category="{{ t.category }}">{{ t.type }}</option>
            {% endfor %}
        </select>

        <label>Manufacture</label>
        <input type="text" name="manufacture">

        <label>Model</label>
        <input type="text" name="model">

        <label>Serial Number</label>
        <input type="text" name="serial_number">

        <label>Company</label>
        <select name="company" required>
            {% for c in companies %}
                <option value="{{ c }}">{{ c }}</option>
            {% endfor %}
        </select>

        <label>Bisnis Unit</label>
        <input type="text" name="bisnis_unit">

        <label>Location</label>
        <input type="text" name="location">

        <label>Room Location</label>
        <input type="text" name="room_location">

        <label>Notes</label>
        <textarea name="notes" rows="2"></textarea>

        <label>Condition</label>
        <input type="text" name="condition">

        <label>Purchase Date</label>
        <input type="date" name="purchase_date" required>

        <label>Purchase Cost</label>
        <input type="number" name="purchase_cost" required>

        <label>Warranty</label>
        <select name="warranty">
            <option value="No">No</option>
            <option value="Yes">Yes</option>
        </select>

        <label>Supplier</label>
        <input type="text" name="supplier">

        <label>Journal</label>
        <input type="text" name="journal">

        <label>Owner</label>
        <select name="owner" required>
            {% for o in owners %}
                <option value="{{ o }}">{{ o }}</option>
            {% endfor %}
        </select>

        <button type="submit">üíæ Simpan Aset</button>
    </form>

    <script>
        function filterTypes() {
            const selectedCategory = document.getElementById("category").value;
            const typeSelect = document.getElementById("type_");
            const options = typeSelect.querySelectorAll("option");

            options.forEach(opt => {
                const belongsTo = opt.getAttribute("data-category");
                if (!belongsTo || belongsTo === selectedCategory) {
                    opt.style.display = "";
                } else {
                    opt.style.display = "none";
                }
            });

            typeSelect.value = "";
        }

        // Auto-filter saat halaman pertama kali load
        document.addEventListener("DOMContentLoaded", filterTypes);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then(function (registration) {
                        console.log('‚úÖ Service Worker registered with scope:', registration.scope);
                    }).catch(function (error) {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
        }
    </script>
	
	<script>
		const allTypes = {{ types | tojson | safe }};

		const categorySelect = document.querySelector('select[name="category"]');
		const typeSelect = document.querySelector('select[name="type_"]');

		function filterTypesByCategory(selectedCategory) {
			typeSelect.innerHTML = '<option value="">-- Pilih Type --</option>';
			allTypes.forEach(row => {
				if (row.Category === selectedCategory) {
					const option = document.createElement("option");
					option.value = row.Type;
					option.textContent = row.Type;
					typeSelect.appendChild(option);
				}
			});
		}

		categorySelect.addEventListener("change", function () {
			filterTypesByCategory(this.value);
		});

		// Trigger on load
		window.addEventListener("DOMContentLoaded", function () {
			filterTypesByCategory(categorySelect.value);
		});
	</script>

</body>
</html>
